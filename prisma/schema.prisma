// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//estrutura do banco de dados
model Categorias {
  id             Int          @id @default(autoincrement())
  nome           String       @db.VarChar(100)
  categoriaPaiId Int?
  categoriaPai   Categorias?  @relation("CategoriaPai", fields: [categoriaPaiId], references: [id])
  subcategorias  Categorias[] @relation("CategoriaPai")
  Produtos       Produtos[]
}

model Usuarios {
  id              Int      @id @default(autoincrement())
  username        String   @unique @db.VarChar(50)
  nome            String   @db.VarChar(255)
  email           String   @unique @db.VarChar(255)
  senha_hash      String   @db.VarChar(255)
  foto_perfil_url String?  @db.VarChar(255)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  Avaliacao_produto     Avaliacao_produto[]
  Comentarios_avaliacao Comentarios_avaliacao[]
  Lojas                 Lojas[]
}

model Produtos {
  id          Int      @id @default(autoincrement())
  lojaId      Int
  categoriaId Int
  nome        String   @db.VarChar(255)
  descricao   String?
  preco       Float
  estoque     Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  loja              Lojas               @relation(fields: [lojaId], references: [id], onUpdate: Cascade, onDelete:Cascade)
  categoria         Categorias          @relation(fields: [categoriaId], references: [id], onUpdate: Cascade)
  Avaliacao_produto Avaliacao_produto[]
  Avaliacoes_loja   Avaliacoes_loja[]
  Imagens_produto   Imagens_produto[]
}

//  author   User    @relation(fields: [authorId], references: [id])

model Avaliacao_produto {
  id         Int      @id @default(autoincrement())
  usuarioId  Int
  produtoId  Int
  nota       Int
  comentario String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  usuario Usuarios @relation(fields: [usuarioId], references: [id], onUpdate: Cascade, onDelete:Cascade)
  produto Produtos @relation(fields: [produtoId], references: [id], onUpdate: Cascade, onDelete:Cascade)

  @@unique([usuarioId, produtoId])
}

model Avaliacoes_loja {
  id         Int      @id @default(autoincrement())
  lojaId     Int
  produtoId  Int
  nota       Int
  comentario String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  loja                  Lojas                   @relation(fields: [lojaId], references: [id], onUpdate: Cascade, onDelete:Cascade)
  produto               Produtos                @relation(fields: [produtoId], references: [id], onUpdate: Cascade, onDelete:Cascade)
  Comentarios_avaliacao Comentarios_avaliacao[]
}

model Comentarios_avaliacao {
  id              Int      @id @default(autoincrement())
  usuarioId       Int
  avaliacaoLojaId Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  usuario       Usuarios        @relation(fields: [usuarioId], references: [id], onUpdate: Cascade, onDelete:Cascade)
  avaliacaoLoja Avaliacoes_loja @relation(fields: [avaliacaoLojaId], references: [id], onUpdate: Cascade, onDelete:Cascade)
}

model Imagens_produto {
  id         Int    @id @default(autoincrement())
  produtoId  Int
  url_imagem String @db.VarChar(255)
  ordem      Int

  produto Produtos @relation(fields: [produtoId], references: [id], onUpdate: Cascade, onDelete:Cascade)
}

model Lojas {
  id              Int               @id @default(autoincrement())
  nome            String            @db.VarChar(255)
  usuarioId       Int
  usuario         Usuarios          @relation(fields: [usuarioId], references: [id], onUpdate: Cascade, onDelete:Cascade)
  descricao       String
  logo_url        String            @db.VarChar(255)
  banner_url      String            @db.VarChar(255)
  sticker_url     String            @db.VarChar(255)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  Produtos        Produtos[]
  Avaliacoes_loja Avaliacoes_loja[]
}
